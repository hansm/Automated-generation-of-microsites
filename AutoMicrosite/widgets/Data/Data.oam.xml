<?xml version="1.0" encoding="UTF-8"?>
<widget name="DataWidget" id="AutoMicrosite/Manual/Data"
		spec="1.0" width="0" height="0" jsClass="AutoMicrosite.Manual.Data"
		xmlns:x="http://automicrosite.maesalu.com/OpenAjaxMetadataExtension"
		xmlns="http://openajax.org/metadata">

	<library name="jQuery" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/" version="1.7.1">
		<require type="javascript" src="jquery.min.js"/>
	</library>

	<require type="javascript"><![CDATA[
	if (typeof(AutoMicrosite) == "undefined") {
		AutoMicrosite = {};
	}
	if (typeof(AutoMicrosite.Manual) == "undefined") {
		AutoMicrosite.Manual = {};
	}
	
	AutoMicrosite.Manual.Data = function() {};
	
	AutoMicrosite.Manual.Data.prototype.onLoad = function() {
		var thisWidget = this;
		
		$.get("Widgets/Data/data.txt", function(data) {
			data = data.split("\n");

			var newData = [];
			var dataRow;
			var dataValues;
			var value;

			for (var i = 0; i < data.length; i++) {
				dataRow = [];
				dataValues = $.map(data[i].split("\t"), $.trim);

				for (var j = 0; j < dataValues.length; j++) {
					value = dataValues[j] == ":" ? null : dataValues[j];
					if (value != null && !isNaN(value)) {
						value = parseFloat(value);
					}
					dataRow.push(value);
				}

				newData.push(dataRow);
			}

			thisWidget.OpenAjax.hub.publish("AutoMicrosite.Data.Receive", newData);
		}, "text");
	};
	]]></require>

	<require type="image" src="data.txt" />
	
	<!-- Empty content element is required by widget loader, somehow it does not work without -->
	<content><![CDATA[ ]]></content>
	
	<topic name="AutoMicrosite.Data.Select" type="object" publish="true">
		<description>
			Query data manager for data based on id and/or column, data will be
			returned to appropriate topic.
		</description>
		<example><![CDATA[
			{"id": "Estonia",
				"column": 2}
		]]></example>
		<property name="id" datatype="string" />
		<property name="column" datatype="number" />
		<property name="data" datatype="array" urlparam="http://schema.org/Table">
			<property name="data" datatype="object">
				<property name="country" datatype="string" urlparam="http://schema.org/Country" />
				<property name="data" datatype="array">
					<property name="data" datatype="object">
						<property name="year" datatype="number" urlparam="http://schema.org/Date" />
						<property name="value" datatype="number" urlparam="http://schema.org/Number" />
					</property>
				</property>
			</property>
		</property>
	</topic>
    
	<categories>
		<category x:iri="http://schema.org/Dataset" />
    </categories>
</widget>
